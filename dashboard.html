
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitLife Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
:root{
  --primary:#1a2a6c;
  --secondary:#b21f1f;
  --accent:#fdbb2d;
  --card-bg: rgba(255,255,255,0.95);
  --sidebar-width: 260px;
  --gap: 20px;
  --radius: 14px;
  --max-content-width: 1400px;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.18);
}

*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%}
body{
  font-family:'Poppins',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background: linear-gradient(135deg,var(--primary),var(--secondary),var(--accent));
  color:#222;
  display:flex;
  justify-content:center;
  padding:20px;
  line-height:1.6;
}
.dashboard-container{
  display:flex;
  width:100%;
  max-width:var(--max-content-width);
  gap:var(--gap);
  align-items:flex-start;
}

/* Sidebar */
.sidebar{
  width:var(--sidebar-width);
  background: linear-gradient(180deg,var(--primary) 0%,var(--secondary) 100%);
  padding:24px 16px;
  height:calc(100vh - 40px);
  box-shadow:var(--shadow-lg);
  border-radius:0 var(--radius) var(--radius) 0;
  display:flex;
  flex-direction:column;
  position:sticky;
  top:20px;
  color:#fff;
  z-index:1002;
}
.sidebar-header{margin-bottom:24px;}
.sidebar-header h3{text-align:center;font-size:1.4rem;letter-spacing:1.2px;font-weight:700;}
.nav-menu{list-style:none;flex:1;display:flex;flex-direction:column;gap:8px;}
.nav-item{
  padding:14px 16px;
  border-radius:10px;
  display:flex;
  align-items:center;
  gap:14px;
  cursor:pointer;
  transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight:600;
  font-size:0.95rem;
  color:#fff;
  background:transparent;
  position:relative;
  overflow:hidden;
}
.nav-item i{font-size:1.15rem;width:24px;text-align:center;}
.nav-item:hover{background:rgba(255,255,255,0.12);transform:translateX(8px);}
.nav-item.active{background:rgba(255,255,255,0.18);box-shadow:var(--shadow-md);transform:translateX(8px);}
.nav-item.active::before{
  content:'';
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:4px;
  background:var(--accent);
  border-radius:0 4px 4px 0;
}

.sidebar-toggle{
  position:fixed;
  top:20px;
  left:20px;
  display:none;
  align-items:center;
  justify-content:center;
  width:48px;
  height:48px;
  border-radius:10px;
  background:rgba(26,42,108,0.95);
  backdrop-filter:blur(10px);
  color:#fff;
  border:none;
  cursor:pointer;
  z-index:1100;
  box-shadow:var(--shadow-md);
  transition:all .2s;
}
.sidebar-toggle:hover{transform:scale(1.05);box-shadow:var(--shadow-lg);}
.sidebar-close{
  display:none;
  align-self:flex-end;
  font-size:1.5rem;
  background:rgba(255,255,255,0.1);
  border:none;
  color:#fff;
  cursor:pointer;
  padding:8px;
  border-radius:8px;
  margin-bottom:12px;
  transition:background .2s;
}
.sidebar-close:hover{background:rgba(255,255,255,0.2);}

/* Main Content */
.main-content{
  flex:1;
  padding:0;
  overflow-y:auto;
  min-width:0;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(12px);
  padding:16px 20px;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  margin-bottom:24px;
}
.header-logo-section{display:flex;align-items:center;gap:16px;}
.user-profile{
  display:flex;
  align-items:center;
  gap:14px;
  background:rgba(255,255,255,0.1);
  padding:8px 14px;
  border-radius:12px;
  transition:background .2s;
}
.user-profile:hover{background:rgba(255,255,255,0.15);}
#userAvatar{
  width:44px;
  height:44px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--primary));
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:1.4rem;
  font-weight:700;
  color:#fff;
  box-shadow:var(--shadow-sm);
}
.user-info h4{font-size:1.05rem;font-weight:600;color:#fff;}
.user-info p{font-size:0.8rem;color:rgba(255,255,255,0.85);margin-top:2px;}
.logout-btn{
  background:var(--secondary);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 16px;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
  font-size:0.9rem;
}
.logout-btn:hover{background:#d32f2f;transform:translateY(-2px);box-shadow:var(--shadow-md);}

/* Stats Grid */
.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
  margin-bottom:28px;
}
.stat-card{
  background:linear-gradient(135deg,rgba(253,187,45,0.95),rgba(26,42,108,0.95));
  color:#fff;
  border-radius:var(--radius);
  padding:24px;
  text-align:center;
  box-shadow:var(--shadow-lg);
  position:relative;
  overflow:hidden;
  cursor:pointer;
  transition:all .3s;
}
.stat-card::before{
  content:'';
  position:absolute;
  top:-50%;
  right:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);
  transition:transform .5s;
}
.stat-card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,0.25);}
.stat-card:hover::before{transform:translate(10%,10%);}
.stat-icon{font-size:2rem;margin-bottom:12px;opacity:0.95;}
.stat-progress-bar{
  width:85%;
  margin:12px auto;
  height:10px;
  border-radius:6px;
  background:rgba(255,255,255,0.2);
  position:relative;
  overflow:hidden;
}
.stat-progress-fill{
  height:100%;
  border-radius:6px;
  background:linear-gradient(90deg,#fff,rgba(255,255,255,0.7));
  transition:width .6s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 0 10px rgba(255,255,255,0.5);
}
.stat-number{font-size:2.2rem;font-weight:800;margin:8px 0;}
.stat-label{font-size:0.95rem;opacity:0.95;font-weight:500;}

/* Sections */
.section{
  display:none;
  background:var(--card-bg);
  padding:28px;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  color:#222;
  animation:slideIn .4s ease-out;
}
@keyframes slideIn{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}
.section h2{
  color:var(--primary);
  font-size:1.6rem;
  font-weight:700;
  margin-bottom:20px;
  padding-bottom:12px;
  border-bottom:3px solid var(--accent);
}

/* Workouts */
.workout-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
}
.workout-card{
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  padding:18px;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  color:#fff;
  text-align:center;
  position:relative;
  transition:all .3s;
  overflow:hidden;
}
.workout-card:hover{transform:translateY(-6px);box-shadow:var(--shadow-lg);}
.workout-card.completed{opacity:0.7;filter:grayscale(0.3);}
.workout-badge{
  position:absolute;
  top:12px;
  left:12px;
  color:#fff;
  font-size:0.75rem;
  border-radius:8px;
  padding:5px 12px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:0.5px;
  box-shadow:var(--shadow-sm);
}
.workout-badge.beginner{background:linear-gradient(135deg,#43cea2,#185a9d);}
.workout-badge.intermediate{background:linear-gradient(135deg,#fdbb2d,#f7971e);}
.workout-badge.advanced{background:linear-gradient(135deg,#ff416c,#ff4b2b);}
.workout-card .completed-check{
  position:absolute;
  top:12px;
  right:12px;
  font-size:1.5rem;
  color:#43cea2;
  filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}
.workout-card h3{font-size:1.1rem;margin:12px 0 8px;font-weight:700;}
.workout-gif{
  width:100%;
  height:130px;
  object-fit:cover;
  border-radius:10px;
  margin-bottom:12px;
  box-shadow:var(--shadow-sm);
}
.timer{
  font-weight:700;
  font-size:1.1rem;
  margin:10px 0;
  color:#fff;
  text-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.btn-container{display:flex;gap:8px;justify-content:center;margin-top:12px;}
.start-btn,.done-btn{
  padding:10px 18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
  font-size:0.9rem;
  transition:all .2s;
  flex:1;
}
.start-btn{
  background:linear-gradient(135deg,#43cea2,#185a9d);
  color:#fff;
  box-shadow:var(--shadow-sm);
}
.start-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.start-btn:disabled{opacity:0.5;cursor:not-allowed;}
.done-btn{
  background:linear-gradient(135deg,#ff416c,#ff4b2b);
  color:#fff;
  box-shadow:var(--shadow-sm);
}
.done-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);}
.done-btn:disabled{opacity:0.5;cursor:not-allowed;}

/* Nutrition */
.nutrition-form{
  background:rgba(26,42,108,0.05);
  padding:20px;
  border-radius:var(--radius);
  margin-bottom:20px;
}
.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
  margin-bottom:14px;
}
.form-grid input,.form-grid select,.form-grid textarea{
  padding:12px 16px;
  border:2px solid rgba(26,42,108,0.15);
  border-radius:8px;
  font-size:0.95rem;
  font-family:inherit;
  transition:all .2s;
  background:#fff;
}
.form-grid input:focus,.form-grid select:focus,.form-grid textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(253,187,45,0.15);
}
.form-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
#nutrition-loading{
  opacity:0;
  transition:opacity .3s;
  color:var(--primary);
  font-weight:600;
}
#aiDietResult{
  white-space:pre-wrap;
  background:rgba(67,206,162,0.08);
  padding:20px;
  border-radius:var(--radius);
  margin-top:16px;
  color:#222;
  border-left:4px solid #43cea2;
  line-height:1.7;
}
#aiDietError{
  background:rgba(255,65,108,0.1);
  color:#c62828;
  padding:16px;
  border-radius:var(--radius);
  border-left:4px solid #ff416c;
  margin-top:16px;
  font-weight:600;
}

/* Progress */
.progress-chart{
  width:100%;
  height:200px;
  background:linear-gradient(135deg,rgba(67,206,162,0.1),rgba(24,90,157,0.1));
  border-radius:var(--radius);
  margin-bottom:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--primary);
  font-weight:700;
  font-size:1.2rem;
  border:2px dashed rgba(26,42,108,0.2);
}
#progressContent p{
  background:rgba(253,187,45,0.08);
  padding:16px 20px;
  border-radius:10px;
  margin-bottom:12px;
  color:#222;
  font-weight:500;
  border-left:4px solid var(--accent);
}

/* Overlay */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  opacity:0;
  visibility:hidden;
  transition:opacity .3s,visibility .3s;
  z-index:1001;
  backdrop-filter:blur(2px);
}
#overlay.show{opacity:1;visibility:visible;}

/* Responsive */
@media (max-width:1100px){
  .stats-grid{grid-template-columns:repeat(2,1fr);}
  .sidebar{height:auto;position:relative;top:0;border-radius:var(--radius);}
}

@media (max-width:800px){
  body{padding:12px;}
  .dashboard-container{flex-direction:column;gap:16px;}
  .sidebar{
    position:fixed;
    left:0;top:0;bottom:0;
    width:var(--sidebar-width);
    transform:translateX(-110%);
    transition:transform .3s cubic-bezier(0.4, 0, 0.2, 1);
    height:100%;
    border-radius:0 var(--radius) var(--radius) 0;
    box-shadow:var(--shadow-lg);
  }
  .sidebar.open{transform:translateX(0);}
  .sidebar-toggle{display:inline-flex;}
  .sidebar-close{display:inline-block;}
  .main-content{padding:0;}
  .header{flex-direction:column;align-items:flex-start;gap:12px;padding:14px;}
  .header-logo-section{width:100%;}
  .user-profile{width:100%;justify-content:space-between;}
  .stats-grid{grid-template-columns:1fr;gap:16px;}
  .section{padding:20px;}
  .workout-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));}
  .workout-gif{height:100px;}
}

@media (max-width:480px){
  .stats-grid{gap:14px;}
  .workout-grid{grid-template-columns:1fr;gap:16px;}
  .nav-item i{font-size:1rem;}
  .nav-item{font-size:0.9rem;padding:12px 14px;}
  .section h2{font-size:1.3rem;}
  .form-grid{grid-template-columns:1fr;}
}

@media (min-width:1400px){
  .stat-card{padding:32px;}
  .workout-gif{height:150px;}
}
</style>
</head>
<body>
<div class="dashboard-container">
<nav class="sidebar">
  <button class="sidebar-close" aria-label="Close menu"><i class="fas fa-times"></i></button>
  <div class="sidebar-header"><h3><i class="fas fa-dumbbell"></i> FitLife</h3></div>
  <ul class="nav-menu">
    <li class="nav-item active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
    <li class="nav-item" data-section="workouts"><i class="fas fa-dumbbell"></i> Workouts</li>
    <li class="nav-item" data-section="nutrition"><i class="fas fa-apple-alt"></i> Nutrition</li>
    <li class="nav-item" data-section="progress"><i class="fas fa-chart-line"></i> Progress</li>
    <li class="nav-item" data-section="profile"><i class="fas fa-user"></i> Profile</li>
  </ul>
</nav>

<main class="main-content">
<button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle menu"><i class="fas fa-bars"></i></button>

<header class="header">
  <div class="header-logo-section">
    <img src="https://seeklogo.com/images/F/fit-life-logo-B9A7A4B092-seeklogo.com.png" alt="FitLife Logo" style="height:52px;">
  </div>
  <div class="user-profile">
    <div id="userAvatar">J</div>
    <div class="user-info">
      <h4 id="userName">John Doe</h4>
      <p id="userEmail">john@example.com</p>
    </div>
    <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</header>

<div id="overlay" aria-hidden="true"></div>

<div id="dashboard" class="section" style="display:block;">
  <h2><i class="fas fa-home"></i> Dashboard Overview</h2>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-dumbbell"></i></div>
      <div class="stat-progress-bar"><div class="stat-progress-fill" id="progress-workouts" style="width:45%"></div></div>
      <div class="stat-number" id="workoutsCompleted">0</div>
      <div class="stat-label">Workouts Completed</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-fire"></i></div>
      <div class="stat-progress-bar"><div class="stat-progress-fill" id="progress-calories" style="width:75%"></div></div>
      <div class="stat-number">1250</div>
      <div class="stat-label">Calories Burned</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-trophy"></i></div>
      <div class="stat-progress-bar"><div class="stat-progress-fill" id="progress-goal" style="width:65%"></div></div>
      <div class="stat-number">65%</div>
      <div class="stat-label">Goal Progress</div>
    </div>
  </div>
</div>

<div id="workouts" class="section">
  <h2><i class="fas fa-dumbbell"></i> My Workouts</h2>
  <div id="workoutList" class="workout-grid"></div>
</div>

<div id="nutrition" class="section">
  <h2><i class="fas fa-apple-alt"></i> Nutrition Plan</h2>
  <div class="nutrition-form">
    <div class="form-grid">
      <input id="ai-age" type="number" placeholder="Age" />
      <select id="ai-sex">
        <option value="">Select Sex</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="other">Other</option>
      </select>
      <input id="ai-weight" type="number" placeholder="Weight (kg)" />
      <input id="ai-height" type="number" placeholder="Height (cm)" />
      <select id="ai-activity">
        <option value="">Activity Level</option>
        <option value="sedentary">Sedentary</option>
        <option value="light">Light Activity</option>
        <option value="moderate">Moderate Activity</option>
        <option value="active">Very Active</option>
      </select>
      <select id="ai-goal">
        <option value="">Fitness Goal</option>
        <option value="lose">Lose Weight</option>
        <option value="maintain">Maintain Weight</option>
        <option value="gain">Gain Muscle</option>
      </select>
      <input id="ai-meals" type="number" placeholder="Meals/day (e.g. 3)" />
    </div>
    <textarea id="ai-preferences" placeholder="Dietary preferences, allergies, or foods to avoid..." style="width:100%;min-height:90px;margin-bottom:14px;padding:12px 16px;border:2px solid rgba(26,42,108,0.15);border-radius:8px;font-family:inherit;"></textarea>
    <div class="form-actions">
      <button id="generateDietBtn" class="start-btn"><i class="fas fa-magic"></i> Generate AI Diet</button>
      <button id="clearDietBtn" class="done-btn"><i class="fas fa-eraser"></i> Clear</button>
      <div id="nutrition-loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
    </div>
    <pre id="aiDietResult" style="display:none;"></pre>
    <p id="aiDietError" style="display:none;"></p>
  </div>
</div>

<div id="progress" class="section">
  <h2><i class="fas fa-chart-line"></i> Progress Tracking</h2>
  <div class="progress-chart" id="progressChart">
    <i class="fas fa-chart-area" style="margin-right:8px;"></i> Weekly Progress Chart Coming Soon
  </div>
  <div id="progressContent">
    <p><strong>Goal:</strong> Weight Loss</p>
    <p><strong>Progress:</strong> 65% Complete</p>
    <p><strong>Next Target:</strong> Lose 2 kg</p>
  </div>
</div>

<div id="profile" class="section">
  <h2><i class="fas fa-user"></i> Profile Settings</h2>
  <p>Update your profile information, preferences, and account settings here.</p>
</div>
</main>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCYOzxUWAPd4ifIKUOXY0TQQvWJStRaeYk",
  authDomain: "fitlife-8e768.firebaseapp.com",
  projectId: "fitlife-8e768",
  storageBucket: "fitlife-8e768.appspot.com",
  messagingSenderId: "721770808033",
  appId: "1:721770808033:web:adb64336eb674c3679eda0",
  measurementId: "G-BLNN73G7VK"
};
if (!window.firebase || !firebase.apps || firebase.apps.length === 0) {
  firebase.initializeApp(firebaseConfig);
}
const auth = firebase.auth();

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  const nameEl = document.getElementById("userName");
  const emailEl = document.getElementById("userEmail");
  const avatar = document.getElementById("userAvatar");
  const displayName = user.displayName || '';
  const email = user.email || '';
  if (nameEl) nameEl.textContent = displayName || email || 'User';
  if (emailEl) emailEl.textContent = email;
  if (avatar) avatar.textContent = (displayName ? displayName.charAt(0).toUpperCase() : (email ? email.charAt(0).toUpperCase() : 'U'));
});

// Section switching
const navItems = document.querySelectorAll('.nav-item');
const sections = {
  dashboard: document.getElementById('dashboard'),
  workouts: document.getElementById('workouts'),
  nutrition: document.getElementById('nutrition'),
  progress: document.getElementById('progress'),
  profile: document.getElementById('profile')
};

navItems.forEach(item => {
  item.addEventListener('click', () => {
    navItems.forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    Object.keys(sections).forEach(k => {
      sections[k].style.display = k === item.dataset.section ? 'block' : 'none';
    });
    if (window.innerWidth <= 800) closeSidebar();
  });
});

// Sidebar toggle
const sidebar = document.querySelector('.sidebar');
const overlay = document.getElementById('overlay');
const toggleBtn = document.getElementById('sidebarToggle');
const closeBtn = document.querySelector('.sidebar-close');

function openSidebar() {
  sidebar.classList.add('open');
  overlay.classList.add('show');
  document.body.style.overflow = 'hidden';
}
function closeSidebar() {
  sidebar.classList.remove('open');
  overlay.classList.remove('show');
  document.body.style.overflow = '';
}

if (toggleBtn) toggleBtn.addEventListener('click', (e) => {
  e.preventDefault();
  sidebar.classList.contains('open') ? closeSidebar() : openSidebar();
});
if (closeBtn) closeBtn.addEventListener('click', closeSidebar);
if (overlay) overlay.addEventListener('click', closeSidebar);

window.addEventListener('resize', () => {
  if (window.innerWidth > 800) closeSidebar();
});

// Logout
async function logout() {
  const btns = document.querySelectorAll('.logout-btn');
  btns.forEach(b => b.disabled = true);
  try {
    await auth.signOut();
    window.location.href = `${window.location.origin}/login.html`;
  } catch (err) {
    console.error('Sign out error', err);
    btns.forEach(b => b.disabled = false);
  }
}
document.querySelectorAll('.logout-btn').forEach(btn => {
  btn.addEventListener('click', (e) => { e.preventDefault(); logout(); });
});

// Workouts
const workoutsData = [
  { name: "Full Body Strength", gif: "https://i.gifer.com/7efs.gif", difficulty: "intermediate" },
  { name: "Cardio Run", gif: "https://i.gifer.com/7vH9.gif", difficulty: "beginner" },
  { name: "Push Ups", gif: "https://i.gifer.com/7vG3.gif", difficulty: "beginner" },
  { name: "Squats", gif: "https://i.gifer.com/7fXY.gif", difficulty: "beginner" },
  { name: "Plank", gif: "https://i.gifer.com/7fZ4.gif", difficulty: "intermediate" },
  { name: "Lunges", gif: "https://i.gifer.com/7gT1.gif", difficulty: "intermediate" },
  { name: "Bicep Curls", gif: "https://i.gifer.com/7hG7.gif", difficulty: "beginner" },
  { name: "Tricep Dips", gif: "https://i.gifer.com/7hH8.gif", difficulty: "intermediate" },
  { name: "Mountain Climbers", gif: "https://i.gifer.com/7hL9.gif", difficulty: "advanced" },
  { name: "Burpees", gif: "https://i.gifer.com/7hP0.gif", difficulty: "advanced" }
];

const workoutList = document.getElementById('workoutList');
workoutsData.forEach((workout) => {
  let currentSet = 1;
  let timerInterval;

  const card = document.createElement('div');
  card.className = 'workout-card';

  const badge = document.createElement('span');
  badge.className = `workout-badge ${workout.difficulty}`;
  badge.textContent = workout.difficulty.charAt(0).toUpperCase() + workout.difficulty.slice(1);
  card.appendChild(badge);

  const img = document.createElement('img');
  img.src = workout.gif;
  img.className = 'workout-gif';
  img.alt = workout.name;

  const title = document.createElement('h3');
  title.textContent = `${workout.name} - Set ${currentSet}/3`;

  const timerEl = document.createElement('div');
  timerEl.className = 'timer';
  timerEl.textContent = "Press Start";

  const startBtn = document.createElement('button');
  startBtn.className = 'start-btn';
  startBtn.innerHTML = '<i class="fas fa-play"></i> Start';

  const doneBtn = document.createElement('button');
  doneBtn.className = 'done-btn';
  doneBtn.innerHTML = '<i class="fas fa-check"></i> Done';
  doneBtn.disabled = true;

  const btnContainer = document.createElement('div');
  btnContainer.className = 'btn-container';
  btnContainer.appendChild(startBtn);
  btnContainer.appendChild(doneBtn);

  card.appendChild(img);
  card.appendChild(title);
  card.appendChild(timerEl);
  card.appendChild(btnContainer);
  workoutList.appendChild(card);

  function formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
  }

  function startTimer(duration, callback) {
    let time = duration;
    timerEl.textContent = formatTime(time);
    timerInterval = setInterval(() => {
      time--;
      timerEl.textContent = formatTime(time);
      if (time <= 0) {
        clearInterval(timerInterval);
        callback();
      }
    }, 1000);
  }

  startBtn.onclick = () => {
    startBtn.disabled = true;
    doneBtn.disabled = false;
    startTimer(300, completeSet);
  };

  doneBtn.onclick = () => {
    clearInterval(timerInterval);
    completeSet();
  };

  function completeSet() {
    if (currentSet < 3) {
      timerEl.textContent = "1 min break";
      startBtn.disabled = true;
      doneBtn.disabled = true;
      setTimeout(() => {
        currentSet++;
        title.textContent = `${workout.name} - Set ${currentSet}/3`;
        timerEl.textContent = "Press Start";
        startBtn.disabled = false;
      }, 60000);
    } else {
      card.classList.add("completed");
      const check = document.createElement('span');
      check.className = "completed-check";
      check.innerHTML = '<i class="fas fa-check-circle"></i>';
      card.appendChild(check);
      timerEl.textContent = "Complete! 3 min rest";
      startBtn.disabled = true;
      doneBtn.disabled = true;
      setTimeout(() => {
        const counter = document.getElementById('workoutsCompleted');
        counter.textContent = parseInt(counter.textContent) + 1;
        const progressBar = document.getElementById('progress-workouts');
        const newWidth = Math.min(100, parseInt(progressBar.style.width) + 10);
        progressBar.style.width = `${newWidth}%`;
      }, 180000);
    }
  }
});

// Nutrition AI
(function() {
  const genBtn = document.getElementById('generateDietBtn');
  const clearBtn = document.getElementById('clearDietBtn');
  const loadingEl = document.getElementById('nutrition-loading');
  const resultEl = document.getElementById('aiDietResult');
  const errEl = document.getElementById('aiDietError');

  function showLoading(on) {
    if (!loadingEl) return;
    loadingEl.style.opacity = on ? '1' : '0';
  }
  function showResult(text) {
    if (!resultEl) return;
    resultEl.style.display = text ? 'block' : 'none';
    resultEl.textContent = text || '';
  }
  function showError(msg) {
    if (!errEl) return;
    errEl.style.display = msg ? 'block' : 'none';
    errEl.textContent = msg || '';
  }

  genBtn?.addEventListener('click', async (e) => {
    e.preventDefault();
    showError('');
    showResult('');
    showLoading(true);
    genBtn.disabled = true;

    const payload = {
      age: document.getElementById('ai-age')?.value || '',
      sex: document.getElementById('ai-sex')?.value || '',
      weightKg: document.getElementById('ai-weight')?.value || '',
      heightCm: document.getElementById('ai-height')?.value || '',
      activity: document.getElementById('ai-activity')?.value || '',
      goal: document.getElementById('ai-goal')?.value || '',
      mealsPerDay: document.getElementById('ai-meals')?.value || '',
      preferences: document.getElementById('ai-preferences')?.value || ''
    };

    try {
      const res = await fetch('http://localhost:3000/api/diet-plan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const text = await res.text();
      let json;
      try { json = text ? JSON.parse(text) : {}; } catch { json = null; }
      if (!res.ok) {
        const detail = (json && (json.error || json.detail)) || text || `Status ${res.status}`;
        showError(`Server error: ${detail}`);
      } else {
        const plan = (json && json.plan) || text || '';
        if (!plan) showError('Empty response from API');
        else showResult(plan);
      }
    } catch (err) {
      console.error(err);
      showError('Network error. Ensure the API endpoint is available.');
    } finally {
      showLoading(false);
      genBtn.disabled = false;
    }
  });

  clearBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    ['ai-age', 'ai-sex', 'ai-weight', 'ai-height', 'ai-activity', 'ai-goal', 'ai-meals', 'ai-preferences'].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (el.tagName === 'SELECT') el.selectedIndex = 0;
      else el.value = '';
    });
    showResult('');
    showError('');
  });
})();
</script>
</body>
</html>
