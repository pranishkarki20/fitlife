<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitLife Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
:root {--primary:#1a2a6c;--secondary:#b21f1f;--accent:#fdbb2d;--card-bg: rgba(255,255,255,0.85);}
body {margin:0;font-family:'Poppins',sans-serif;background: linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);color:#fff;display:flex;}
.dashboard-container{display:flex;width:100%;}
.sidebar {width:240px;background: linear-gradient(to bottom,#1a2a6c,#b21f1f);padding:20px;height:100vh;box-shadow:2px 0 15px rgba(0,0,0,0.2);border-radius:0 20px 20px 0;display:flex;flex-direction:column;}
.sidebar-header h3{text-align:center;margin-bottom:30px;font-size:1.6rem;letter-spacing:1px;}
.nav-menu{list-style:none;padding:0;flex:1;}
.nav-item{padding:14px 12px;border-radius:12px;margin-bottom:10px;display:flex;align-items:center;gap:12px;cursor:pointer;transition: all 0.3s ease;font-weight:500;}
.nav-item i{font-size:1.2rem;}
.nav-item:hover,.nav-item.active{background: rgba(255,255,255,0.2);transform: translateX(5px);box-shadow: 0 4px 12px rgba(0,0,0,0.3);}
.main-content{flex:1;padding:25px;overflow-y:auto;}
.header{display:flex;justify-content:space-between;align-items:center;background: rgba(255,255,255,0.25);backdrop-filter: blur(15px);padding:15px 20px;border-radius:15px;box-shadow:0 8px 25px rgba(0,0,0,0.2);margin-bottom:25px;}
.user-profile{display:flex;align-items:center;gap:15px;background: rgba(255,255,255,0.3);padding:6px 12px;border-radius:12px;backdrop-filter: blur(10px);}
.user-profile h4{margin:0;font-size:1rem;}
.user-profile p{margin:0;font-size:0.75rem;color:#fff;}
.logout-btn{background: var(--secondary);color:#fff;border:none;border-radius:8px;padding:6px 10px;font-weight:600;cursor:pointer;transition:0.3s;}
.logout-btn:hover{background:#8d1818;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-bottom:30px;}
.stat-card{background: linear-gradient(135deg,#fdbb2d,#b21f1f);color:#fff;border-radius:18px;padding:25px 20px;text-align:center;box-shadow:0 8px 20px rgba(0,0,0,0.2);transition: transform 0.3s ease, box-shadow 0.3s ease;}
.stat-card:hover{transform:translateY(-5px);box-shadow:0 12px 30px rgba(0,0,0,0.3);}
.stat-icon{font-size:2rem;margin-bottom:10px;}
.stat-number{font-size:2rem;font-weight:bold;}
.stat-label{font-size:0.95rem;margin-top:5px;}
.section{display:none;background: var(--card-bg);padding:25px;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.section h2{margin-top:0;color: var(--primary);font-size:1.5rem;margin-bottom:15px;}
.workout-grid {display:grid;grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));gap: 15px;}
.workout-card {background: linear-gradient(135deg, #ff9a9e, #fad0c4);padding: 12px;border-radius: 12px;box-shadow: 0 6px 15px rgba(0,0,0,0.2);color: #fff;text-align: center;transition: transform 0.3s ease, box-shadow 0.3s ease;font-size: 0.9rem;}
.workout-card:hover {transform: translateY(-3px);box-shadow: 0 10px 25px rgba(0,0,0,0.25);}
.workout-card h3 {font-size: 1rem;margin-bottom: 8px;text-shadow: 1px 1px 2px rgba(0,0,0,0.3);}
.workout-gif {width: 100%;max-height: 100px;object-fit: cover;border-radius: 10px;margin-bottom: 8px;box-shadow: 0 3px 10px rgba(0,0,0,0.2);transition: transform 0.3s ease;}
.workout-gif:hover {transform: scale(1.02);}
.timer {font-size: 1rem;font-weight: bold;margin-bottom: 8px;text-shadow: 1px 1px 2px rgba(0,0,0,0.4);}
.start-btn,.done-btn{padding:6px 14px;font-size:0.85rem;font-weight:600;border:none;border-radius:8px;cursor:pointer;transition:all 0.3s ease;margin:2px;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
.start-btn {background: linear-gradient(45deg, #43cea2, #185a9d); color:#fff;}
.start-btn:hover {transform: translateY(-2px);box-shadow: 0 4px 10px rgba(0,0,0,0.25);}
.done-btn {background: linear-gradient(45deg, #ff416c, #ff4b2b); color:#fff;}
.done-btn:hover {transform: translateY(-2px); box-shadow: 0 5px 12px rgba(0,0,0,0.25);}
#nutritionList li,#progressContent p{background: rgba(255,255,255,0.15); padding:12px 15px; border-radius:12px; margin-bottom:10px; color:#fff;}
#nutritionList li:hover,#progressContent p:hover{background: rgba(255,255,255,0.25);}
@media(max-width:768px){.sidebar{display:none;}}
</style>
</head>
<body>
<div class="dashboard-container">
<nav class="sidebar">
  <div class="sidebar-header"><h3>FitLife Menu</h3></div>
  <ul class="nav-menu">
    <li class="nav-item active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
    <li class="nav-item" data-section="workouts"><i class="fas fa-dumbbell"></i> Workouts</li>
    <li class="nav-item" data-section="nutrition"><i class="fas fa-apple-alt"></i> Nutrition</li>
    <li class="nav-item" data-section="progress"><i class="fas fa-chart-line"></i> Progress</li>
    <li class="nav-item" data-section="profile"><i class="fas fa-user"></i> Profile</li>
  </ul>
</nav>

<main class="main-content">
<header class="header">
<img src="https://seeklogo.com/images/F/fit-life-logo-B9A7A4B092-seeklogo.com.png" alt="FitLife Logo" style="height:48px;">
<div class="user-profile">
  <div id="userAvatar" style="width:40px;height:40px;border-radius:50%;background:#eee;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.3rem;">J</div>
  <div class="user-info">
    <h4 id="userName">John Doe</h4>
    <p id="userEmail">john@example.com</p>
  </div>
  <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
</div>
</header>

<div id="dashboard" class="section" style="display:block;">
  <div class="stats-grid">
    <div class="stat-card"><div class="stat-icon"><i class="fas fa-dumbbell"></i></div><div class="stat-number" id="workoutsCompleted">0</div><div class="stat-label">Workouts Completed</div></div>
    <div class="stat-card"><div class="stat-icon"><i class="fas fa-fire"></i></div><div class="stat-number">1250</div><div class="stat-label">Calories Burned</div></div>
    <div class="stat-card"><div class="stat-icon"><i class="fas fa-trophy"></i></div><div class="stat-number">65%</div><div class="stat-label">Goal Progress</div></div>
  </div>
</div>

<div id="workouts" class="section"><h2>Workouts</h2>
<div id="workoutList" class="workout-grid"></div>
</div>

<div id="nutrition" class="section">
  <h2>Nutrition</h2>
  <!-- Keep non-AI nutrition UI (manual meal list / localStorage) here if you want -->
  <!-- ...existing nutrition UI... -->
</div>

<div id="progress" class="section"><h2>Progress</h2>
<div id="progressContent">
<p>Goal: Weight Loss</p>
<p>Progress: 65%</p>
<p>Next target: Lose 2 kg</p>
</div>
</div>

<div id="profile" class="section"><h2>Profile</h2><p>Update your profile here.</p></div>
</main>
</div>

<!-- add Firebase SDKs (place before the script below) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

<script>
  // Firebase config (reuse same config from login.html)
  const firebaseConfig = {
    apiKey: "AIzaSyCYOzxUWAPd4ifIKUOXY0TQQvWJStRaeYk",
    authDomain: "fitlife-8e768.firebaseapp.com",
    projectId: "fitlife-8e768",
    storageBucket: "fitlife-8e768.appspot.com",
    messagingSenderId: "721770808033",
    appId: "1:721770808033:web:adb64336eb674c3679eda0",
    measurementId: "G-BLNN73G7VK"
  };

  // initialize only if not already initialized
  if (window.firebase === undefined || !firebase.apps || firebase.apps.length === 0) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();

  // Populate UI from authenticated user instead of prompt()
  auth.onAuthStateChanged(user => {
    if (!user) {
      // not signed in -> redirect to login page
      window.location.href = 'login.html';
      return;
    }

    const nameEl = document.getElementById("userName");
    const emailEl = document.getElementById("userEmail");
    const avatar = document.getElementById("userAvatar");

    const displayName = user.displayName || '';
    const email = user.email || '';

    if (nameEl) nameEl.textContent = displayName || email || 'User';
    if (emailEl) emailEl.textContent = email;
    if (avatar) avatar.textContent = (displayName ? displayName.charAt(0).toUpperCase() : (email ? email.charAt(0).toUpperCase() : 'U'));
  });

  // Section switching (keep existing behavior)
  const navItems = document.querySelectorAll('.nav-item');
  const sections = {
    dashboard: document.getElementById('dashboard'),
    workouts: document.getElementById('workouts'),
    nutrition: document.getElementById('nutrition'),
    progress: document.getElementById('progress'),
    profile: document.getElementById('profile')
  };
  navItems.forEach(item => item.addEventListener('click', () => {
    navItems.forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    Object.keys(sections).forEach(k => sections[k].style.display = k === item.dataset.section ? 'block' : 'none');
  }));

  // Replace prompt-based logout with Firebase sign out
  async function logout() {
    // disable logout buttons while signing out
    const btns = document.querySelectorAll('.logout-btn');
    btns.forEach(b => b.disabled = true);

    try {
      await auth.signOut();
      window.location.href = 'login.html';
    } catch (err) {
      console.error('Sign out error', err);
      btns.forEach(b => b.disabled = false);
    }
  }

  // Ensure any .logout-btn uses the same handler (works even if you remove inline onclick)
  document.querySelectorAll('.logout-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      logout();
    });
  });

  // Workouts Data
  const workoutsData = [
    { name: "Full Body Strength", gif: "https://i.gifer.com/7efs.gif" },
    { name: "Cardio Run", gif: "https://i.gifer.com/7vH9.gif" },
    { name: "Push Ups", gif: "https://i.gifer.com/7vG3.gif" },
    { name: "Squats", gif: "https://i.gifer.com/7fXY.gif" },
    { name: "Plank", gif: "https://i.gifer.com/7fZ4.gif" },
    { name: "Lunges", gif: "https://i.gifer.com/7gT1.gif" },
    { name: "Bicep Curls", gif: "https://i.gifer.com/7hG7.gif" },
    { name: "Tricep Dips", gif: "https://i.gifer.com/7hH8.gif" },
    { name: "Mountain Climbers", gif: "https://i.gifer.com/7hL9.gif" },
    { name: "Burpees", gif: "https://i.gifer.com/7hP0.gif" }
  ];

  const workoutList = document.getElementById('workoutList');

  workoutsData.forEach((workout, idx) => {
    let currentSet = 1;
    let timerInterval;

    const card = document.createElement('div');
    card.className = 'workout-card';

    const title = document.createElement('h3');
    title.textContent = `${workout.name} - Set ${currentSet}/3`;

    const img = document.createElement('img');
    img.src = workout.gif;
    img.className = 'workout-gif';

    const timerEl = document.createElement('div');
    timerEl.className = 'timer';
    timerEl.textContent = "Press Start";

    const startBtn = document.createElement('button');
    startBtn.className = 'start-btn';
    startBtn.textContent = "Start Set";

    const doneBtn = document.createElement('button');
    doneBtn.className = 'done-btn';
    doneBtn.textContent = "Complete Set";
    doneBtn.disabled = true;

    const btnContainer = document.createElement('div');
    btnContainer.appendChild(startBtn);
    btnContainer.appendChild(doneBtn);

    card.appendChild(title);
    card.appendChild(img);
    card.appendChild(timerEl);
    card.appendChild(btnContainer);
    workoutList.appendChild(card);

    function formatTime(sec){const m=Math.floor(sec/60);const s=sec%60;return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;}

    function startTimer(duration, callback){
      let time = duration;
      timerEl.textContent = formatTime(time);
      timerInterval = setInterval(()=>{
        time--;
        timerEl.textContent = formatTime(time);
        if(time<=0){clearInterval(timerInterval);callback();}
      },1000);
    }

    startBtn.onclick = ()=>{
      startBtn.disabled = true;
      doneBtn.disabled = false;
      startTimer(300, completeSet);
    };

    doneBtn.onclick = ()=>{
      clearInterval(timerInterval);
      completeSet();
    };

    function completeSet(){
      if(currentSet <3){
        timerEl.textContent = "1 min break";
        startBtn.disabled = true; doneBtn.disabled=true;
        setTimeout(()=>{
          currentSet++;
          title.textContent = `${workout.name} - Set ${currentSet}/3`;
          timerEl.textContent="Press Start";
          startBtn.disabled=false;
        },60000);
      }else{
        timerEl.textContent="Exercise Complete! 3 min break";
        startBtn.disabled=true; doneBtn.disabled=true;
        setTimeout(()=>{document.getElementById('workoutsCompleted').textContent=parseInt(document.getElementById('workoutsCompleted').textContent)+1;},180000);
      }
    }
  });

  // ensure auth is available: const auth = firebase.auth();

  async function getIdToken() {
    try {
      const user = firebase.auth().currentUser;
      if (!user) return null;
      return await user.getIdToken(false);
    } catch {
      return null;
    }
  }

  // Ensure no references remain to AI elements or functions:
  // ai-nutrition-form, generateDietBtn, saveDietBtn, aiDietResult, nutrition-loading
  // If any event listeners reference those IDs, remove them or guard with presence checks.
  // Example guard removal snippet:
  const maybeAiForm = document.getElementById('ai-nutrition-form');
  if (maybeAiForm) {
    maybeAiForm.remove(); // remove leftover element if present
  }
  // Also remove any global handlers created for AI (if present)
  if (window.loadNutrition) {
    // keep nutrition loader, but ensure it doesn't rely on AI
  }
</script>
</body>
</html>
