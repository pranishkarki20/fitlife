<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitLife Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --primary:#1a2a6c;
  --secondary:#b21f1f;
  --accent:#fdbb2d;
  --card-bg: rgba(255,255,255,0.95);
  --sidebar-width: 260px;
  --gap: 20px;
  --radius: 14px;
  --max-content-width: 1400px;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.18);
}

*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%}
body{
  font-family:'Poppins',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background: linear-gradient(135deg,var(--primary),var(--secondary),var(--accent));
  color:#222;
  display:flex;
  justify-content:center;
  padding:20px;
  line-height:1.6;
  overflow-x:hidden;
}
.dashboard-container{
  display:flex;
  width:100%;
  max-width:var(--max-content-width);
  gap:var(--gap);
  align-items:flex-start;
  position:relative;
}

/* Sidebar */
.sidebar{
  width:var(--sidebar-width);
  background: linear-gradient(180deg,var(--primary) 0%,var(--secondary) 100%);
  padding:24px 16px;
  height:calc(100vh - 40px);
  box-shadow:var(--shadow-lg);
  border-radius:var(--radius);
  display:flex;
  flex-direction:column;
  position:fixed;
  left:-280px;
  top:20px;
  color:#fff;
  z-index:1002;
  transition:left .3s cubic-bezier(0.4, 0, 0.2, 1);
}
.sidebar.open{left:20px;}
.sidebar-header{margin-bottom:24px;text-align:center;}
.sidebar-header h3{font-size:1.4rem;letter-spacing:1.2px;font-weight:700;}
.nav-menu{list-style:none;flex:1;display:flex;flex-direction:column;gap:8px;}
.nav-item{
  padding:14px 16px;
  border-radius:10px;
  display:flex;
  align-items:center;
  gap:14px;
  cursor:pointer;
  transition:all .25s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight:600;
  font-size:0.95rem;
  color:#fff;
  background:transparent;
  position:relative;
  overflow:hidden;
}
.nav-item i{font-size:1.15rem;width:24px;text-align:center;}
.nav-item:hover{background:rgba(255,255,255,0.12);transform:translateX(8px);}
.nav-item.active{background:rgba(255,255,255,0.18);box-shadow:var(--shadow-md);transform:translateX(8px);}
.nav-item.active::before{
  content:'';
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:4px;
  background:var(--accent);
  border-radius:0 4px 4px 0;
}

.sidebar-toggle{
  position:fixed;
  top:20px;
  left:20px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:52px;
  height:52px;
  border-radius:12px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  border:none;
  cursor:pointer;
  z-index:1100;
  box-shadow:var(--shadow-lg);
  transition:all .3s;
  font-size:1.3rem;
}
.sidebar-toggle:hover{transform:scale(1.1);box-shadow:0 8px 28px rgba(0,0,0,0.35);}
.sidebar-toggle.active{left:calc(var(--sidebar-width) + 30px);background:var(--secondary);}

.sidebar-close{
  display:inline-flex;
  align-self:flex-end;
  font-size:1.5rem;
  background:rgba(255,255,255,0.15);
  border:none;
  color:#fff;
  cursor:pointer;
  padding:8px 12px;
  border-radius:8px;
  margin-bottom:12px;
  transition:all .2s;
  align-items:center;
  justify-content:center;
}
.sidebar-close:hover{background:rgba(255,255,255,0.25);transform:scale(1.05);}

/* Main Content */
.main-content{
  flex:1;
  padding:0;
  overflow-y:auto;
  min-width:0;
  max-width:100%;
  container-type: inline-size;
  width:100%;
  margin-left:0;
  transition:margin-left .3s;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(12px);
  padding:16px 20px;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  margin-bottom:24px;
  margin-left:70px;
}
.header-logo-section{display:flex;align-items:center;gap:16px;}
.user-profile{
  display:flex;
  align-items:center;
  gap:14px;
  background:rgba(255,255,255,0.1);
  padding:8px 14px;
  border-radius:12px;
  transition:background .2s;
}
.user-profile:hover{background:rgba(255,255,255,0.15);}
#userAvatar{
  width:44px;
  height:44px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--primary));
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:1.4rem;
  font-weight:700;
  color:#fff;
  box-shadow:var(--shadow-sm);
}
.user-info h4{font-size:1.05rem;font-weight:600;color:#fff;}
.user-info p{font-size:0.8rem;color:rgba(255,255,255,0.85);margin-top:2px;}
.logout-btn{
  background:var(--secondary);
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 16px;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
  font-size:0.9rem;
}
.logout-btn:hover{background:#d32f2f;transform:translateY(-2px);box-shadow:var(--shadow-md);}

/* Stats Grid */
.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:20px;
  margin-bottom:28px;
}
.stat-card{
  background:linear-gradient(135deg,rgba(253,187,45,0.95),rgba(26,42,108,0.95));
  color:#fff;
  border-radius:var(--radius);
  padding:24px;
  text-align:center;
  box-shadow:var(--shadow-lg);
  position:relative;
  overflow:hidden;
  cursor:pointer;
  transition:all .3s;
}
.stat-card::before{
  content:'';
  position:absolute;
  top:-50%;
  right:-50%;
  width:200%;
  height:200%;
  background:radial-gradient(circle,rgba(255,255,255,0.1) 0%,transparent 70%);
  transition:transform .5s;
}
.stat-card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,0.25);}
.stat-card:hover::before{transform:translate(10%,10%);}
.stat-icon{font-size:2rem;margin-bottom:12px;opacity:0.95;}
.stat-progress-bar{
  width:85%;
  margin:12px auto;
  height:10px;
  border-radius:6px;
  background:rgba(255,255,255,0.2);
  position:relative;
  overflow:hidden;
}
.stat-progress-fill{
  height:100%;
  border-radius:6px;
  background:linear-gradient(90deg,#fff,rgba(255,255,255,0.7));
  transition:width .6s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 0 10px rgba(255,255,255,0.5);
}
.stat-number{font-size:2.2rem;font-weight:800;margin:8px 0;}
.stat-label{font-size:0.95rem;opacity:0.95;font-weight:500;}

/* Sections */
.section{
  display:none;
  background:var(--card-bg);
  padding:28px;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  color:#222;
  animation:slideIn .4s ease-out;
  max-width:100%;
  overflow-x:hidden;
}
@keyframes slideIn{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}
.section h2{
  color:var(--primary);
  font-size:1.6rem;
  font-weight:700;
  margin-bottom:20px;
  padding-bottom:12px;
  border-bottom:3px solid var(--accent);
}

/* **UPDATED** Progress Section Styles */
.weight-input-section{
  background:linear-gradient(135deg,rgba(67,206,162,0.08),rgba(24,90,157,0.08));
  padding:28px;
  border-radius:var(--radius);
  margin-bottom:24px;
  border-left:5px solid var(--accent);
}
.weight-input-section h3{
  color:var(--primary);
  margin-bottom:20px;
  font-size:1.3rem;
}
.weight-form{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
  align-items:end;
}
.weight-form input{
  padding:14px;
  border:2px solid rgba(26,42,108,0.2);
  border-radius:10px;
  font-size:1rem;
  transition:all .3s;
  background:#fff;
}
.weight-form input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(253,187,45,0.2);
}
.add-weight-btn{
  padding:14px 28px;
  background:linear-gradient(135deg,#43cea2,#185a9d);
  color:#fff;
  border:none;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  transition:all .3s;
  font-size:1.05rem;
  box-shadow:var(--shadow-md);
}
.add-weight-btn:hover{
  transform:translateY(-3px);
  box-shadow:var(--shadow-lg);
}

.chart-container{
  background:#fff;
  padding:24px;
  border-radius:12px;
  box-shadow:var(--shadow-md);
  margin-top:24px;
  border-left:5px solid #43cea2;
}
.chart-container h3{
  color:var(--primary);
  margin-bottom:20px;
  font-size:1.3rem;
}
.chart-wrapper{
  position:relative;
  height:400px;
  width:100%;
}
.progress-summary{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
  margin-top:24px;
}
.summary-card{
  background:linear-gradient(135deg,rgba(67,206,162,0.1),rgba(24,90,157,0.1));
  padding:20px;
  border-radius:12px;
  text-align:center;
  border-left:4px solid var(--accent);
}
.summary-card h5{
  color:var(--primary);
  font-size:0.9rem;
  margin-bottom:8px;
  text-transform:uppercase;
}
.summary-card p{
  font-size:1.8rem;
  font-weight:700;
  color:var(--primary);
}
.goal-display{
  text-align:center;
  padding:20px;
  background:linear-gradient(135deg,rgba(26,42,108,0.1),rgba(253,187,45,0.1));
  border-radius:var(--radius);
  margin-bottom:24px;
}
.goal-display p{
  font-size:1.1rem;
  font-weight:600;
  color:var(--primary);
  margin:0;
}
.goal-display i{
  margin-right:8px;
  color:var(--accent);
}

/* Workout Section styles remain the same... */
.workout-header-container{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:28px;
  gap:16px;
  max-width:100%;
  min-width:0;
  padding:20px;
  background:linear-gradient(135deg,rgba(26,42,108,0.08),rgba(253,187,45,0.08));
  border-radius:var(--radius);
  border-left:5px solid var(--accent);
  flex-wrap:wrap;
}
.workout-header-container h2{
  margin:0;
  padding:0;
  border:none;
  flex:1 1 auto;
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  display:flex;
  align-items:center;
  gap:12px;
}
.workout-tabs{
  display:flex;
  gap:12px;
  flex:0 1 auto;
  flex-wrap:wrap;
  min-width:0;
}
.workout-tab-btn{
  padding:14px 24px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,var(--accent),var(--primary));
  color:#fff;
  font-weight:700;
  cursor:pointer;
  transition:all .3s;
  box-shadow:var(--shadow-md);
  white-space:nowrap;
  flex:0 0 auto;
  font-size:1rem;
}
.workout-tab-btn:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg);}
.workout-tab-btn.active{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  box-shadow:var(--shadow-lg);
  transform:scale(1.05);
}

.workout-content{max-width:100%;overflow-x:hidden;}

.today-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  padding:24px;
  border-radius:var(--radius);
  margin-bottom:28px;
  box-shadow:var(--shadow-lg);
  position:relative;
  overflow:hidden;
  flex-wrap:wrap;
  gap:16px;
}
.today-header h3{font-size:1.6rem;margin:0;position:relative;z-index:1;}
.today-header .date-info{font-size:1rem;opacity:0.95;margin-top:6px;position:relative;z-index:1;}
.today-header-right{text-align:right;position:relative;z-index:1;}
.today-header-right p{font-size:1rem;opacity:0.95;}
.empty-workout{
  text-align:center;
  padding:80px 30px;
  background:linear-gradient(135deg,rgba(253,187,45,0.08),rgba(67,206,162,0.08));
  border-radius:var(--radius);
  border:3px dashed rgba(26,42,108,0.2);
  position:relative;
  overflow:hidden;
}
.empty-workout i{font-size:5rem;color:var(--accent);margin-bottom:24px;position:relative;z-index:1;}
.empty-workout h3{color:var(--primary);margin-bottom:16px;font-size:1.5rem;position:relative;z-index:1;}
.empty-workout p{color:#666;margin-bottom:28px;font-size:1.05rem;position:relative;z-index:1;}
.empty-workout .btn-create-schedule{
  padding:16px 36px;
  background:linear-gradient(135deg,var(--accent),var(--primary));
  color:#fff;
  border:none;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
  transition:all .3s;
  font-size:1.1rem;
  box-shadow:var(--shadow-lg);
  position:relative;
  z-index:1;
}
.empty-workout .btn-create-schedule:hover{
  transform:translateY(-4px) scale(1.05);
  box-shadow:0 12px 40px rgba(0,0,0,0.3);
}

.today-exercises{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(min(280px, 100%),1fr));
  gap:24px;
  width:100%;
  max-width:100%;
}
.today-exercise-card{
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  padding:24px;
  border-radius:var(--radius);
  box-shadow:var(--shadow-md);
  color:#fff;
  transition:all .3s;
  position:relative;
  overflow:hidden;
  min-width:0;
}
.today-exercise-card:hover{
  transform:translateY(-8px);
  box-shadow:0 16px 40px rgba(0,0,0,0.25);
}
.today-exercise-card h4{
  font-size:1.3rem;
  margin-bottom:20px;
  font-weight:700;
  position:relative;
  z-index:1;
}
.exercise-details{
  display:flex;
  flex-direction:column;
  gap:14px;
  position:relative;
  z-index:1;
}
.exercise-detail-item{
  display:flex;
  align-items:center;
  gap:12px;
  background:rgba(255,255,255,0.25);
  padding:12px;
  border-radius:10px;
  min-width:0;
  backdrop-filter:blur(5px);
}
.exercise-detail-item i{font-size:1.2rem;flex-shrink:0;}
.exercise-detail-item span{min-width:70px;font-weight:700;flex-shrink:0;font-size:0.95rem;}
.exercise-detail-item input{
  flex:1;
  min-width:0;
  padding:10px 14px;
  border:none;
  border-radius:8px;
  background:#fff;
  color:var(--primary);
  font-weight:700;
  font-size:1rem;
}
.mark-complete-btn{
  width:100%;
  padding:14px;
  background:linear-gradient(135deg,#43cea2,#185a9d);
  color:#fff;
  border:none;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  margin-top:14px;
  transition:all .3s;
  font-size:1.05rem;
  position:relative;
  z-index:1;
  box-shadow:var(--shadow-sm);
}
.mark-complete-btn:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(0,0,0,0.3);
}
.mark-complete-btn.completed{
  background:linear-gradient(135deg,#43cea2,#43cea2);
  opacity:0.75;
  cursor:default;
}

.custom-schedule-container{
  background:linear-gradient(135deg,rgba(67,206,162,0.08),rgba(24,90,157,0.08));
  padding:28px;
  border-radius:var(--radius);
  margin-bottom:28px;
  max-width:100%;
  overflow:hidden;
  border:2px solid rgba(26,42,108,0.1);
}
.custom-schedule-container h3{
  color:var(--primary);
  margin-bottom:24px;
  font-size:1.4rem;
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.day-selector{
  display:flex;
  gap:12px;
  margin-bottom:28px;
  overflow-x:auto;
  padding-bottom:12px;
  min-width:0;
}
.day-btn{
  min-width:110px;
  padding:14px 18px;
  border:3px solid var(--primary);
  border-radius:12px;
  background:#fff;
  color:var(--primary);
  font-weight:700;
  cursor:pointer;
  transition:all .3s;
  text-align:center;
  flex-shrink:0;
  font-size:0.95rem;
  box-shadow:var(--shadow-sm);
}
.day-btn:hover{
  background:rgba(26,42,108,0.08);
  transform:translateY(-3px);
  box-shadow:var(--shadow-md);
}
.day-btn.active{
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
  transform:scale(1.08);
  box-shadow:var(--shadow-lg);
}
.exercise-picker{
  background:#fff;
  padding:24px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:var(--shadow-md);
  max-width:100%;
  overflow:hidden;
  border-left:5px solid var(--accent);
}
.exercise-picker h4{
  color:var(--primary);
  margin-bottom:16px;
  font-size:1.2rem;
  display:flex;
  align-items:center;
  gap:10px;
}
.exercise-search{
  width:100%;
  max-width:100%;
  padding:14px 16px;
  border:3px solid rgba(26,42,108,0.15);
  border-radius:10px;
  font-size:1rem;
  margin-bottom:16px;
  transition:all .3s;
}
.exercise-search:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(253,187,45,0.2);
}
.exercise-list{
  max-height:250px;
  overflow-y:auto;
  overflow-x:hidden;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(min(190px, 100%),1fr));
  gap:12px;
  max-width:100%;
  padding:4px;
}
.exercise-item{
  padding:14px;
  border:2px solid rgba(26,42,108,0.1);
  border-radius:10px;
  cursor:pointer;
  transition:all .3s;
  background:#fff;
  font-size:0.95rem;
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  font-weight:600;
  text-align:center;
  box-shadow:var(--shadow-sm);
}
.exercise-item:hover{
  border-color:var(--accent);
  background:linear-gradient(135deg,rgba(253,187,45,0.15),rgba(67,206,162,0.15));
  transform:translateY(-4px);
  box-shadow:var(--shadow-md);
}
.selected-exercises{
  background:#fff;
  padding:24px;
  border-radius:12px;
  min-height:180px;
  box-shadow:var(--shadow-md);
  max-width:100%;
  overflow:hidden;
  border-left:5px solid #43cea2;
}
.selected-exercises h4{
  color:var(--primary);
  margin-bottom:16px;
  font-size:1.2rem;
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.selected-exercise-card{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  background:linear-gradient(135deg,rgba(67,206,162,0.12),rgba(24,90,157,0.12));
  border-radius:10px;
  margin-bottom:12px;
  border-left:5px solid var(--accent);
  min-width:0;
  gap:12px;
  transition:all .3s;
  box-shadow:var(--shadow-sm);
}
.selected-exercise-card:hover{
  transform:translateX(6px);
  box-shadow:var(--shadow-md);
}
.selected-exercise-card .exercise-name{
  font-weight:700;
  color:var(--primary);
  flex:1;
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  font-size:1.05rem;
}
.remove-exercise-btn{
  background:var(--secondary);
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:8px;
  cursor:pointer;
  font-size:0.9rem;
  transition:all .3s;
  flex-shrink:0;
  font-weight:700;
  box-shadow:var(--shadow-sm);
}
.remove-exercise-btn:hover{
  background:#d32f2f;
  transform:scale(1.1);
  box-shadow:var(--shadow-md);
}
.save-schedule-btn{
  width:100%;
  padding:18px;
  background:linear-gradient(135deg,#43cea2,#185a9d);
  color:#fff;
  border:none;
  border-radius:12px;
  font-weight:700;
  font-size:1.15rem;
  cursor:pointer;
  transition:all .3s;
  margin-top:20px;
  box-shadow:var(--shadow-lg);
}
.save-schedule-btn:hover{
  transform:translateY(-4px);
  box-shadow:0 12px 36px rgba(0,0,0,0.3);
}

/* Overlay */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  opacity:0;
  visibility:hidden;
  transition:opacity .3s,visibility .3s;
  z-index:1001;
  backdrop-filter:blur(3px);
}
#overlay.show{opacity:1;visibility:visible;}

/* Responsive Design */
@media (max-width:1200px){
  .stats-grid{grid-template-columns:repeat(2,1fr);}
}

@media (max-width:900px){
  body{padding:12px;}
  .header{margin-left:70px;padding:14px 16px;flex-wrap:wrap;}
  .header-logo-section img{height:40px;}
  .user-profile{width:100%;}
  .stats-grid{grid-template-columns:1fr;gap:16px;}
  .section{padding:20px;}
  .today-exercises{grid-template-columns:repeat(auto-fill,minmax(min(250px, 100%),1fr));}
  .workout-header-container{padding:16px;flex-direction:column;align-items:flex-start;}
  .workout-tabs{width:100%;}
  .exercise-list{grid-template-columns:repeat(auto-fill,minmax(min(150px, 100%),1fr));}
  .weight-form{grid-template-columns:1fr;}
  .progress-summary{grid-template-columns:1fr;}
}

@media (max-width:600px){
  body{padding:8px;}
  .sidebar{
    left:-100%;
    width:85%;
    max-width:280px;
    top:8px;
    height:calc(100vh - 16px);
  }
  .sidebar.open{left:8px;}
  .sidebar-toggle{
    width:48px;
    height:48px;
    top:12px;
    left:12px;
    font-size:1.2rem;
  }
  .sidebar-toggle.active{left:calc(85% - 36px);}
  .header{
    margin-left:62px;
    padding:12px;
    flex-direction:column;
    align-items:flex-start;
    gap:12px;
  }
  .user-info h4{font-size:0.95rem;}
  .user-info p{font-size:0.75rem;}
  .section h2{font-size:1.3rem;}
  .workout-header-container h2{font-size:1.2rem;}
  .workout-tabs{flex-direction:column;width:100%;}
  .workout-tab-btn{width:100%;justify-content:center;}
  .day-selector{gap:8px;}
  .day-btn{min-width:90px;font-size:0.85rem;padding:12px 14px;}
  .today-header{flex-direction:column;align-items:flex-start;padding:18px;}
  .today-header h3{font-size:1.3rem;}
  .today-header-right{text-align:left;}
  .empty-workout{padding:50px 20px;}
  .empty-workout i{font-size:4rem;}
  .empty-workout h3{font-size:1.3rem;}
  .today-exercises{grid-template-columns:1fr;}
  .exercise-list{grid-template-columns:1fr;}
  .stats-grid{gap:14px;}
  .chart-wrapper{height:300px;}
}
</style>
</head>
<body>
<div class="dashboard-container">
<button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle menu">
  <i class="fas fa-bars"></i>
</button>

<nav class="sidebar" id="sidebar">
  <button class="sidebar-close" id="sidebarClose" aria-label="Close menu">
    <i class="fas fa-times"></i>
  </button>
  <div class="sidebar-header"><h3><i class="fas fa-dumbbell"></i> FitLife</h3></div>
  <ul class="nav-menu">
    <li class="nav-item active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
    <li class="nav-item" data-section="workouts"><i class="fas fa-dumbbell"></i> Workouts</li>
    <li class="nav-item" data-section="progress"><i class="fas fa-chart-line"></i> Progress</li>
    <li class="nav-item" data-section="profile"><i class="fas fa-user"></i> Profile</li>
  </ul>
</nav>

<main class="main-content">
<header class="header">
  <div class="header-logo-section">
    <img src="https://seeklogo.com/images/F/fit-life-logo-B9A7A4B092-seeklogo.com.png" alt="FitLife Logo" style="height:52px;">
  </div>
  <div class="user-profile">
    <div id="userAvatar">J</div>
    <div class="user-info">
      <h4 id="userName">John Doe</h4>
      <p id="userEmail">john@example.com</p>
    </div>
    <button class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</header>

<div id="overlay" aria-hidden="true"></div>

<div id="dashboard" class="section" style="display:block;">
  <h2><i class="fas fa-home"></i> Dashboard Overview</h2>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-dumbbell"></i></div>
      <div class="stat-progress-bar"><div class="stat-progress-fill" id="progress-workouts" style="width:45%"></div></div>
      <div class="stat-number" id="workoutsCompleted">0</div>
      <div class="stat-label">Workouts Completed</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-fire"></i></div>
      <div class="stat-progress-bar"><div class="stat-progress-fill" id="progress-calories" style="width:75%"></div></div>
      <div class="stat-number">1250</div>
      <div class="stat-label">Calories Burned</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-trophy"></i></div>
      <div class="stat-progress-bar"><div class="stat-progress-fill" id="progress-goal" style="width:65%"></div></div>
      <div class="stat-number">65%</div>
      <div class="stat-label">Goal Progress</div>
    </div>
  </div>
</div>

<div id="workouts" class="section">
  <div class="workout-header-container">
    <h2><i class="fas fa-dumbbell"></i> My Workouts</h2>
    <div class="workout-tabs">
      <button class="workout-tab-btn active" data-tab="today"><i class="fas fa-calendar-day"></i> Today</button>
      <button class="workout-tab-btn" data-tab="custom"><i class="fas fa-calendar-alt"></i> Schedule</button>
    </div>
  </div>

  <div id="todayWorkout" class="workout-content">
    <div class="today-header">
      <div>
        <h3 id="todayDayName">Monday</h3>
        <p class="date-info" id="todayDate">October 5, 2025</p>
      </div>
      <div class="today-header-right">
        <p><i class="fas fa-fire"></i> Stay Consistent!</p>
      </div>
    </div>
    <div id="todayWorkoutContent"></div>
  </div>

  <div id="customSchedule" class="workout-content" style="display:none;">
    <div class="custom-schedule-container">
      <h3><i class="fas fa-calendar-alt"></i> Build Your Weekly Schedule</h3>
      
      <div class="day-selector">
        <button class="day-btn active" data-day="Monday">Monday</button>
        <button class="day-btn" data-day="Tuesday">Tuesday</button>
        <button class="day-btn" data-day="Wednesday">Wednesday</button>
        <button class="day-btn" data-day="Thursday">Thursday</button>
        <button class="day-btn" data-day="Friday">Friday</button>
        <button class="day-btn" data-day="Saturday">Saturday</button>
        <button class="day-btn" data-day="Sunday">Sunday</button>
      </div>

      <div class="exercise-picker">
        <h4><i class="fas fa-search"></i> Add Exercises</h4>
        <input type="text" class="exercise-search" id="exerciseSearch" placeholder="Search exercises...">
        <div class="exercise-list" id="exerciseList"></div>
      </div>

      <div class="selected-exercises">
        <h4><i class="fas fa-check-circle"></i> <span id="currentDayLabel">Monday</span>'s Workout</h4>
        <div id="selectedExercisesList"></div>
      </div>

      <button class="save-schedule-btn" id="saveScheduleBtn">
        <i class="fas fa-save"></i> Save My Schedule
      </button>
    </div>
  </div>
</div>

<div id="progress" class="section">
  <h2><i class="fas fa-chart-line"></i> Progress Tracking</h2>
  
  <!-- Goal Display -->
  <div class="goal-display">
    <p id="userGoalText"><i class="fas fa-bullseye"></i> Your goal is not set.</p>
  </div>

  <!-- Weight Input Section -->
  <div class="weight-input-section">
    <h3><i class="fas fa-plus-circle"></i> Add Weekly Weight Entry</h3>
    <div class="weight-form">
      <input type="date" id="weightDate" />
      <input type="number" id="weightValue" placeholder="Weight (kg)" step="0.1" min="0" />
      <button class="add-weight-btn" id="addWeightBtn">
        <i class="fas fa-plus"></i> Add Entry
      </button>
    </div>
  </div>

  <!-- Chart Display -->
  <div class="chart-container">
    <h3><i class="fas fa-chart-area"></i> Your Progress Chart</h3>
    <div class="chart-wrapper">
      <canvas id="progressChart"></canvas>
    </div>
    
    <!-- Progress Summary -->
    <div class="progress-summary">
      <div class="summary-card">
        <h5>Starting Weight</h5>
        <p id="startWeight">--</p>
      </div>
      <div class="summary-card">
        <h5>Current Weight</h5>
        <p id="currentWeight">--</p>
      </div>
      <div class="summary-card">
        <h5>Total Change</h5>
        <p id="totalChange">--</p>
      </div>
      <div class="summary-card">
        <h5>Goal Status</h5>
        <p id="goalStatus">Not Set</p>
      </div>
    </div>
  </div>
</div>

<div id="profile" class="section">
  <h2><i class="fas fa-user"></i> Profile Settings</h2>
  <p>Here you will be able to change your fitness goal and other profile information.</p>
</div>
</main>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCYOzxUWAPd4ifIKUOXY0TQQvWJStRaeYk",
    authDomain: "fitlife-8e768.firebaseapp.com",
    projectId: "fitlife-8e768",
    storageBucket: "fitlife-8e768.appspot.com",
    messagingSenderId: "721770808033",
    appId: "1:721770808033:web:adb64336eb674c3679eda0"
  };
  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUserData = null; // Store user profile data
  let progressChart = null;

  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = 'login.html';
      return;
    }

    try {
      const userDoc = await db.collection('users').doc(user.uid).get();
      if (!userDoc.exists || !userDoc.data().onboardingComplete) {
        window.location.href = 'onboarding.html';
        return;
      }
      
      currentUserData = userDoc.data();
      
      // Update UI with user data
      const nameEl = document.getElementById("userName");
      const emailEl = document.getElementById("userEmail");
      const avatar = document.getElementById("userAvatar");
      const displayName = currentUserData.displayName || user.email || "User";
      
      if (nameEl) nameEl.textContent = displayName;
      if (emailEl) emailEl.textContent = user.email;
      if (avatar) avatar.textContent = displayName.charAt(0).toUpperCase();

      // Initialize dashboard modules
      loadSchedule();
      renderTodaysWorkout();
      loadProgressData();

    } catch (err) {
      console.error('Error checking user profile:', err);
      window.location.href = 'onboarding.html';
    }
  });

  const navItems = document.querySelectorAll('.nav-item');
  const sections = {
    dashboard: document.getElementById('dashboard'),
    workouts: document.getElementById('workouts'),
    progress: document.getElementById('progress'),
    profile: document.getElementById('profile')
  };

  navItems.forEach(item => {
    item.addEventListener('click', () => {
      navItems.forEach(i => i.classList.remove('active'));
      item.classList.add('active');
      Object.keys(sections).forEach(k => {
        sections[k].style.display = k === item.dataset.section ? 'block' : 'none';
      });
      closeSidebar();
    });
  });

  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  const toggleBtn = document.getElementById('sidebarToggle');
  const closeBtn = document.getElementById('sidebarClose');

  function openSidebar() {
    sidebar.classList.add('open');
    overlay.classList.add('show');
    toggleBtn.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeSidebar() {
    sidebar.classList.remove('open');
    overlay.classList.remove('show');
    toggleBtn.classList.remove('active');
    document.body.style.overflow = '';
  }

  function toggleSidebar() {
    if (sidebar.classList.contains('open')) {
      closeSidebar();
    } else {
      openSidebar();
    }
  }

  if (toggleBtn) toggleBtn.addEventListener('click', toggleSidebar);
  if (closeBtn) closeBtn.addEventListener('click', closeSidebar);
  if (overlay) overlay.addEventListener('click', closeSidebar);

  window.addEventListener('resize', () => {
    if (window.innerWidth > 900) {
      closeSidebar();
    }
  });

  async function logout() {
    const btns = document.querySelectorAll('.logout-btn');
    btns.forEach(b => b.disabled = true);
    try {
      await auth.signOut();
      window.location.href = 'login.html';
    } catch (err) {
      console.error('Sign out error', err);
      btns.forEach(b => b.disabled = false);
    }
  }
  document.querySelectorAll('.logout-btn').forEach(btn => {
    btn.addEventListener('click', (e) => { e.preventDefault(); logout(); });
  });

  const workoutTabs = document.querySelectorAll('.workout-tab-btn');
  const todayWorkout = document.getElementById('todayWorkout');
  const customSchedule = document.getElementById('customSchedule');

  workoutTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      workoutTabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      if (tab.dataset.tab === 'today') {
        todayWorkout.style.display = 'block';
        customSchedule.style.display = 'none';
      } else {
        todayWorkout.style.display = 'none';
        customSchedule.style.display = 'block';
      }
    });
  });

  function getCurrentDay() {
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const today = new Date();
    return days[today.getDay()];
  }

  function getFormattedDate() {
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const today = new Date();
    return `${months[today.getMonth()]} ${today.getDate()}, ${today.getFullYear()}`;
  }

  const availableExercises = [
    "Push Ups", "Squats", "Lunges", "Plank", "Burpees", "Mountain Climbers", "Jumping Jacks", 
    "Bicep Curls", "Tricep Dips", "Leg Raises", "Crunches", "Russian Twists", "High Knees", 
    "Sit Ups", "Deadlifts", "Bench Press", "Shoulder Press", "Lat Pulldown", "Pull Ups", 
    "Dips", "Leg Press", "Calf Raises", "Cardio Run", "Cycling", "Swimming", "Rowing", "Jump Rope", "Box Jumps"
  ];

  let customWorkoutSchedule = {
    Monday: [], Tuesday: [], Wednesday: [], Thursday: [], Friday: [], Saturday: [], Sunday: []
  };
  let currentDay = 'Monday';

  function loadSchedule() {
    const saved = localStorage.getItem('fitlifeCustomSchedule');
    if (saved) {
      try {
        customWorkoutSchedule = JSON.parse(saved);
      } catch (e) { console.error('Error loading schedule:', e); }
    }
  }

  function saveSchedule() {
    localStorage.setItem('fitlifeCustomSchedule', JSON.stringify(customWorkoutSchedule));
  }

  function renderTodaysWorkout() {
    const today = getCurrentDay();
    document.getElementById('todayDayName').textContent = today;
    document.getElementById('todayDate').textContent = getFormattedDate();
    
    const todayExercises = customWorkoutSchedule[today] || [];
    const container = document.getElementById('todayWorkoutContent');
    
    if (todayExercises.length === 0) {
      container.innerHTML = `<div class="empty-workout"><i class="fas fa-calendar-plus"></i><h3>No Workout Scheduled for Today</h3><p>Create your custom workout schedule to see exercises here!</p><button class="btn-create-schedule" onclick="switchToCustomTab()"><i class="fas fa-plus-circle"></i> Create Schedule</button></div>`;
      return;
    }
    
    container.innerHTML = '<div class="today-exercises" id="todayExercisesList"></div>';
    const exercisesList = document.getElementById('todayExercisesList');
    
    todayExercises.forEach((exercise, index) => {
      const card = document.createElement('div');
      card.className = 'today-exercise-card';
      card.innerHTML = `<h4><i class="fas fa-dumbbell"></i> ${exercise}</h4><div class="exercise-details"><div class="exercise-detail-item"><i class="fas fa-redo"></i><span>Sets:</span><input type="number" placeholder="3" min="1" id="sets-${index}"></div><div class="exercise-detail-item"><i class="fas fa-hashtag"></i><span>Reps:</span><input type="number" placeholder="12" min="1" id="reps-${index}"></div><div class="exercise-detail-item"><i class="fas fa-clock"></i><span>Rest (sec):</span><input type="number" placeholder="60" min="0" id="rest-${index}"></div></div><button class="mark-complete-btn" onclick="markExerciseComplete(${index}, this)"><i class="fas fa-check"></i> Mark as Complete</button>`;
      exercisesList.appendChild(card);
    });
  }

  window.markExerciseComplete = function(index, btn) {
    if (btn.classList.contains('completed')) return;
    btn.classList.add('completed');
    btn.innerHTML = '<i class="fas fa-check-circle"></i> Completed!';
    const counter = document.getElementById('workoutsCompleted');
    counter.textContent = parseInt(counter.textContent) + 1;
    const progressBar = document.getElementById('progress-workouts');
    const newWidth = Math.min(100, parseInt(progressBar.style.width) + 5);
    progressBar.style.width = `${newWidth}%`;
  };

  window.switchToCustomTab = function() { document.querySelector('[data-tab="custom"]').click(); };

  function renderExerciseList(filter = '') {
    const exerciseList = document.getElementById('exerciseList');
    exerciseList.innerHTML = '';
    const filtered = availableExercises.filter(ex => ex.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(exercise => {
      const item = document.createElement('div');
      item.className = 'exercise-item';
      item.textContent = exercise;
      item.addEventListener('click', () => addExerciseToDay(exercise));
      exerciseList.appendChild(item);
    });
  }

  function addExerciseToDay(exercise) {
    if (!customWorkoutSchedule[currentDay].includes(exercise)) {
      customWorkoutSchedule[currentDay].push(exercise);
      renderSelectedExercises();
      renderTodaysWorkout();
    }
  }

  function removeExerciseFromDay(exercise) {
    customWorkoutSchedule[currentDay] = customWorkoutSchedule[currentDay].filter(ex => ex !== exercise);
    renderSelectedExercises();
    renderTodaysWorkout();
  }

  function renderSelectedExercises() {
    const container = document.getElementById('selectedExercisesList');
    container.innerHTML = '';
    if (customWorkoutSchedule[currentDay].length === 0) {
      container.innerHTML = '<p style="color:#999;text-align:center;padding:30px;font-size:1.05rem;">No exercises added yet. Select exercises from above.</p>';
      return;
    }
    customWorkoutSchedule[currentDay].forEach(exercise => {
      const card = document.createElement('div');
      card.className = 'selected-exercise-card';
      card.innerHTML = `<span class="exercise-name">${exercise}</span><button class="remove-exercise-btn" onclick="removeExerciseFromDay('${exercise}')"><i class="fas fa-trash"></i> Remove</button>`;
      container.appendChild(card);
    });
  }

  const dayButtons = document.querySelectorAll('.day-btn');
  dayButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      dayButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentDay = btn.dataset.day;
      document.getElementById('currentDayLabel').textContent = currentDay;
      renderSelectedExercises();
    });
  });

  const exerciseSearch = document.getElementById('exerciseSearch');
  exerciseSearch.addEventListener('input', (e) => { renderExerciseList(e.target.value); });

  document.getElementById('saveScheduleBtn').addEventListener('click', () => {
    saveSchedule();
    renderTodaysWorkout();
    alert('✅ Your custom workout schedule has been saved successfully!');
  });
  
  renderExerciseList();
  renderSelectedExercises();

  // **UPDATED** PROGRESS TRACKING FUNCTIONALITY
  async function loadProgressData() {
    if (!currentUserData) return;

    // Display user's goal
    const goalText = document.getElementById('userGoalText');
    const goal = currentUserData.fitnessGoal;
    const goalDisplayMap = {
      lose: 'Lose Weight',
      maintain: 'Maintain Weight',
      gain: 'Gain Muscle'
    };
    if(goalText) goalText.innerHTML = `<i class="fas fa-bullseye"></i> Your Goal: <strong>${goalDisplayMap[goal] || 'Not Set'}</strong>`;
    
    // Set today's date as default
    document.getElementById('weightDate').valueAsDate = new Date();

    // Fetch weight entries
    try {
      const snapshot = await db.collection('users').doc(auth.currentUser.uid).collection('weightEntries').orderBy('timestamp', 'asc').get();
      const weightData = snapshot.docs.map(doc => doc.data());
      updateChart(weightData);
      updateSummary(weightData);
    } catch(err) {
      console.error("Error fetching weight data: ", err);
    }
  }

  document.getElementById('addWeightBtn').addEventListener('click', async () => {
    const dateInput = document.getElementById('weightDate');
    const weightInput = document.getElementById('weightValue');
    const date = dateInput.value;
    const weight = parseFloat(weightInput.value);

    if (!date || !weight || weight <= 0) {
      alert('Please enter a valid date and weight!');
      return;
    }

    try {
      await db.collection('users').doc(auth.currentUser.uid).collection('weightEntries').add({
        weight: weight,
        date: date,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      
      // Also update the currentWeight in the main user document
      await db.collection('users').doc(auth.currentUser.uid).update({ currentWeight: weight });

      weightInput.value = '';
      dateInput.valueAsDate = new Date();
      loadProgressData(); // Refresh data
      alert('✅ Weight entry added successfully!');
    } catch(err) {
      console.error("Error adding weight entry: ", err);
      alert("Error saving entry. Please try again.");
    }
  });

  function initChart() {
    const ctx = document.getElementById('progressChart').getContext('2d');
    progressChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Weight (kg)',
          data: [],
          borderColor: '#1a2a6c',
          backgroundColor: 'rgba(26, 42, 108, 0.1)',
          borderWidth: 3,
          pointRadius: 6,
          pointHoverRadius: 8,
          pointBackgroundColor: '#fdbb2d',
          pointBorderColor: '#1a2a6c',
          pointBorderWidth: 2,
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'top' } },
        scales: {
          y: { beginAtZero: false, ticks: { callback: (value) => value + ' kg' } }
        }
      }
    });
  }

  function updateChart(weightData) {
    if (!progressChart) initChart();
    
    const labels = weightData.map(entry => {
      const date = new Date(entry.date);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });
    const data = weightData.map(entry => entry.weight);
    
    progressChart.data.labels = labels;
    progressChart.data.datasets[0].data = data;
    progressChart.update();
  }

  function updateSummary(weightData) {
    if (!currentUserData || weightData.length === 0) {
      document.getElementById('startWeight').textContent = currentUserData?.startingWeight ? currentUserData.startingWeight.toFixed(1) + ' kg' : '--';
      document.getElementById('currentWeight').textContent = '--';
      document.getElementById('totalChange').textContent = '--';
      document.getElementById('goalStatus').textContent = 'No Entries';
      return;
    }
    
    const startWeight = currentUserData.startingWeight;
    const currentWeight = weightData[weightData.length - 1].weight;
    const change = currentWeight - startWeight;

    document.getElementById('startWeight').textContent = startWeight.toFixed(1) + ' kg';
    document.getElementById('currentWeight').textContent = currentWeight.toFixed(1) + ' kg';
    document.getElementById('totalChange').textContent = (change >= 0 ? '+' : '') + change.toFixed(1) + ' kg';
    
    let goalStatus = 'Not Set';
    const goal = currentUserData.fitnessGoal;
    if (goal) {
      if (goal === 'lose' && change < 0) goalStatus = '✓ On Track';
      else if (goal === 'gain' && change > 0) goalStatus = '✓ On Track';
      else if (goal === 'maintain' && Math.abs(change) < 2) goalStatus = '✓ Maintaining';
      else goalStatus = 'Needs Attention';
    }
    document.getElementById('goalStatus').textContent = goalStatus;
  }
</script>
</body>
</html>
